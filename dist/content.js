console.log("ClipBook Content Script Loaded (콘텐츠 스크립트 로드됨)");const i=()=>{var e,o;try{return!!((e=chrome.runtime)!=null&&e.id&&((o=chrome.storage)!=null&&o.local))}catch{return!1}};document.addEventListener("mouseup",()=>{try{if(!i())return;const e=window.getSelection(),o=e==null?void 0:e.toString().trim(),n=document.getElementById("clipbook-capture-btn");n&&n.remove(),o&&o.length>0&&chrome.storage.local.get(["showFloatingButton"],s=>{try{if(!i()||!(s.showFloatingButton!==!1))return;if(e&&e.rangeCount>0){const l=e.getRangeAt(0).getBoundingClientRect(),t=document.createElement("button");t.id="clipbook-capture-btn",t.textContent="ClipBook 저장",t.style.position="fixed",t.style.top=`${l.bottom+5}px`,t.style.left=`${l.left}px`,t.style.zIndex="999999",t.style.padding="8px 12px",t.style.background="#4361EE",t.style.color="#fff",t.style.border="none",t.style.borderRadius="4px",t.style.cursor="pointer",t.style.fontSize="12px",t.style.fontFamily="sans-serif",t.style.boxShadow="0 2px 5px rgba(0,0,0,0.2)",t.addEventListener("mousedown",a=>{try{if(a.preventDefault(),a.stopPropagation(),!i()){alert("확장 프로그램이 업데이트되었습니다. 페이지를 새로고침해주세요."),t.remove();return}const c={id:Date.now().toString(),text:o,sourceUrl:window.location.href,timestamp:Date.now()};chrome.storage.local.get(["clippings"],d=>{try{if(!i())return;const p=[...d.clippings||[],c];chrome.storage.local.set({clippings:p},()=>{try{if(!i())return;console.log("Saved via Floating Button"),t.textContent="저장 완료!",t.style.background="#10B981",setTimeout(()=>{t.parentNode&&t.remove()},1500)}catch{}})}catch{}})}catch(c){console.debug("ClipBook: Error in button mousedown",c)}}),document.body.appendChild(t)}}catch(r){console.debug("ClipBook: Error in storage callback",r)}})}catch(e){String(e).includes("context invalidated")?console.debug("ClipBook: Extension context invalidated."):console.error("ClipBook mouseup Error:",e)}});chrome.runtime.onMessage.addListener((e,o,n)=>{var s;try{if(!i())return!1;if(e.action==="GET_SELECTION"){const r=((s=window.getSelection())==null?void 0:s.toString())||"";n({text:r})}return!0}catch(r){return console.debug("ClipBook: Error in message handler",r),!1}});document.addEventListener("mousedown",e=>{try{if(e.target.id!=="clipbook-capture-btn"){const n=document.getElementById("clipbook-capture-btn");n&&n.remove()}}catch{}});
