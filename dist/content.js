console.log("ClipBook Content Script Loaded (콘텐츠 스크립트 로드됨)");document.addEventListener("mouseup",()=>{const e=window.getSelection(),n=e==null?void 0:e.toString().trim(),o=document.getElementById("clipbook-capture-btn");o&&o.remove(),n&&n.length>0&&(console.log("Text selected (텍스트 선택됨):",n),chrome.storage.local.get(["showFloatingButton"],r=>{if(r.showFloatingButton!==!1&&e&&e.rangeCount>0){const l=e.getRangeAt(0).getBoundingClientRect(),t=document.createElement("button");t.id="clipbook-capture-btn",t.textContent="ClipBook 저장",t.style.position="fixed",t.style.top=`${l.bottom+5}px`,t.style.left=`${l.left}px`,t.style.zIndex="999999",t.style.padding="8px 12px",t.style.background="#4361EE",t.style.color="#fff",t.style.border="none",t.style.borderRadius="4px",t.style.cursor="pointer",t.style.fontSize="12px",t.style.fontFamily="sans-serif",t.style.boxShadow="0 2px 5px rgba(0,0,0,0.2)",t.addEventListener("mousedown",a=>{var d;a.preventDefault(),a.stopPropagation();const g={id:Date.now().toString(),text:n,sourceUrl:window.location.href,timestamp:Date.now()};try{if(!((d=chrome.runtime)!=null&&d.id)){alert("확장 프로그램이 업데이트되었습니다. 페이지를 새로고침해주세요.");return}chrome.storage.local.get(["clippings"],c=>{if(chrome.runtime.lastError){console.error("Storage error:",chrome.runtime.lastError);return}const u=[...c.clippings||[],g];chrome.storage.local.set({clippings:u},()=>{if(chrome.runtime.lastError){console.error("Storage set error:",chrome.runtime.lastError);return}console.log("Saved via Floating Button (플로팅 버튼으로 저장됨)"),t.textContent="저장 완료!",t.style.background="#10B981",setTimeout(()=>t.remove(),1500)})})}catch(c){console.error("Context invalidation error:",c),alert("확장 프로그램 연결이 끊어졌습니다. 페이지를 새로고침해주세요.")}}),document.body.appendChild(t)}}))});chrome.runtime.onMessage.addListener((e,n,o)=>{var r,s;try{if(!((r=chrome.runtime)!=null&&r.id)){console.warn("Extension context invalidated. (확장 프로그램 컨텍스트가 유효하지 않음)");return}if(e.action==="GET_SELECTION"){const i=((s=window.getSelection())==null?void 0:s.toString())||"";o({text:i})}}catch(i){console.error("Error in content script message handler:",i)}return!0});document.addEventListener("mousedown",e=>{if(e.target.id!=="clipbook-capture-btn"){const o=document.getElementById("clipbook-capture-btn");o&&o.remove()}});
